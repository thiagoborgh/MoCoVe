<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoCoVe AI Trading System - Dashboard Completo</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Axios para requisições -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <style>
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-online { background-color: #10b981; }
        .status-offline { background-color: #ef4444; }
        .status-warning { background-color: #f59e0b; }
        
        .volatility-high { 
            color: #ef4444; 
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .tier-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .tier-1 { background: #fef3c7; color: #92400e; }
        .tier-2 { background: #dbeafe; color: #1e40af; }
        .tier-3 { background: #f3e8ff; color: #7c3aed; }
        .tier-trending { background: #fce7f3; color: #be185d; }
        .tier-defi { background: #dcfce7; color: #166534; }
        .tier-layer1 { background: #fef2f2; color: #991b1b; }
        .tier-ai { background: #ede9fe; color: #6b21a8; }
        
        .performance-positive { color: #059669; }
        .performance-negative { color: #dc2626; }
        .performance-neutral { color: #6b7280; }
        
        .alert-pump { background: #dcfce7; border-left: 4px solid #16a34a; }
        .alert-dump { background: #fef2f2; border-left: 4px solid #dc2626; }
        .alert-volume { background: #fef3c7; border-left: 4px solid #d97706; }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .tab-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tab-inactive {
            background: #e2e8f0;
            color: #64748b;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-blue-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Componente principal
        function MoCoVeApp() {
            // Estados básicos
            const [activeTab, setActiveTab] = useState('overview');
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState('');
            const [notification, setNotification] = useState('');
            const [systemStatus, setSystemStatus] = useState({
                backend: false,
                binance: false,
                ai_agent: false,
                watchlist: false
            });
            
            // Estados de dados
            const [marketData, setMarketData] = useState({});
            const [trades, setTrades] = useState([]);
            const [settings, setSettings] = useState({
                symbol: 'DOGEUSDT',
                amount: 10.0,
                volatility_threshold: 0.02
            });
            
            // Estados da watchlist
            const [watchlist, setWatchlist] = useState(null);
            const [watchlistSummary, setWatchlistSummary] = useState(null);
            const [topPerformers, setTopPerformers] = useState([]);
            const [watchlistAlerts, setWatchlistAlerts] = useState([]);
            const [selectedTier, setSelectedTier] = useState('all');
            const [autoRefresh, setAutoRefresh] = useState(true);

            // API Base URL
            const API_BASE = 'http://localhost:5000';

            // Função para fazer requisições à API
            const apiRequest = async (endpoint, options = {}) => {
                try {
                    const url = `${API_BASE}/api${endpoint}`;
                    const response = await axios({
                        url,
                        method: options.method || 'GET',
                        data: options.data,
                        headers: {
                            'Content-Type': 'application/json',
                            ...options.headers,
                        },
                        timeout: 10000,
                        ...options
                    });
                    
                    return response.data;
                } catch (err) {
                    console.error(`Erro na API ${endpoint}:`, err);
                    if (err.response) {
                        throw new Error(`HTTP ${err.response.status}: ${err.response.statusText}`);
                    } else if (err.request) {
                        throw new Error('Servidor não está respondendo');
                    } else {
                        throw new Error(err.message);
                    }
                }
            };

            // Verificar status do sistema
            const checkSystemStatus = async () => {
                const status = {
                    backend: false,
                    binance: false,
                    ai_agent: false,
                    watchlist: false
                };

                try {
                    // Verificar backend
                    await apiRequest('/status');
                    status.backend = true;

                    // Verificar Binance
                    try {
                        const binanceStatus = await apiRequest('/status');
                        status.binance = binanceStatus.exchange_connected || false;
                    } catch (e) {
                        status.binance = false;
                    }

                    // Verificar watchlist
                    try {
                        await apiRequest('/watchlist/summary');
                        status.watchlist = true;
                    } catch (e) {
                        status.watchlist = false;
                    }

                    // Verificar AI Agent (placeholder)
                    status.ai_agent = false; // Implementar conforme necessário

                } catch (e) {
                    console.error('Erro ao verificar status:', e);
                }

                setSystemStatus(status);
                return status;
            };

            // Carregar dados da watchlist
            const loadWatchlistData = async () => {
                try {
                    const [summaryRes, coinsRes, performersRes, alertsRes] = await Promise.allSettled([
                        apiRequest('/watchlist/summary'),
                        apiRequest('/watchlist/coins'),
                        apiRequest('/watchlist/top-performers?limit=10'),
                        apiRequest('/watchlist/alerts?limit=10')
                    ]);

                    if (summaryRes.status === 'fulfilled') {
                        setWatchlistSummary(summaryRes.value.summary);
                    }

                    if (coinsRes.status === 'fulfilled') {
                        setWatchlist(coinsRes.value.coins);
                    }

                    if (performersRes.status === 'fulfilled') {
                        setTopPerformers(performersRes.value.top_performers || []);
                    }

                    if (alertsRes.status === 'fulfilled') {
                        setWatchlistAlerts(alertsRes.value.alerts || []);
                    }

                } catch (err) {
                    console.error('Erro ao carregar watchlist:', err);
                }
            };

            // Carregar dados básicos
            const loadBasicData = async () => {
                try {
                    const [tradesRes, settingsRes] = await Promise.allSettled([
                        apiRequest('/trades?limit=20'),
                        apiRequest('/settings')
                    ]);

                    if (tradesRes.status === 'fulfilled') {
                        setTrades(tradesRes.value || []);
                    }

                    if (settingsRes.status === 'fulfilled') {
                        setSettings(settingsRes.value || settings);
                    }

                } catch (err) {
                    console.error('Erro ao carregar dados básicos:', err);
                }
            };

            // Atualizar preços da watchlist
            const updateWatchlistPrices = async () => {
                try {
                    setNotification('Atualizando preços...');
                    const result = await apiRequest('/watchlist/update-prices', { method: 'POST' });
                    
                    if (result.success) {
                        setNotification(`✅ ${result.message}`);
                        await loadWatchlistData();
                    } else {
                        setError('Falha ao atualizar preços');
                    }
                    
                    setTimeout(() => setNotification(''), 3000);
                } catch (err) {
                    setError(`Erro ao atualizar preços: ${err.message}`);
                }
            };

            // Executar trade
            const executeTrade = async (type) => {
                try {
                    setNotification(`Executando ${type.toUpperCase()}...`);
                    
                    const result = await apiRequest('/execute_trade', {
                        method: 'POST',
                        data: {
                            type,
                            symbol: settings.symbol,
                            amount: settings.amount
                        }
                    });
                    
                    if (result.success) {
                        setNotification(`✅ ${type.toUpperCase()} executado com sucesso!`);
                        await loadBasicData();
                    } else {
                        setError(result.error || 'Erro no trade');
                    }
                    
                    setTimeout(() => setNotification(''), 5000);
                } catch (err) {
                    setError(`Erro ao executar ${type}: ${err.message}`);
                }
            };

            // Inicializar sistema
            const initializeSystem = async () => {
                setLoading(true);
                setError('');
                
                try {
                    const status = await checkSystemStatus();
                    
                    if (status.backend) {
                        await Promise.all([
                            loadBasicData(),
                            status.watchlist ? loadWatchlistData() : Promise.resolve()
                        ]);
                    }
                    
                } catch (err) {
                    setError(`Erro ao inicializar: ${err.message}`);
                } finally {
                    setLoading(false);
                }
            };

            // Auto-refresh
            useEffect(() => {
                if (autoRefresh) {
                    const interval = setInterval(() => {
                        checkSystemStatus();
                        if (systemStatus.watchlist) {
                            loadWatchlistData();
                        }
                    }, 30000);
                    
                    return () => clearInterval(interval);
                }
            }, [autoRefresh, systemStatus.watchlist]);

            // Inicialização
            useEffect(() => {
                initializeSystem();
            }, []);

            // Renderizar status
            const renderSystemStatus = () => (
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div className="card text-center">
                        <div className={`status-dot ${systemStatus.backend ? 'status-online' : 'status-offline'}`}></div>
                        <span className="text-sm font-medium">
                            Backend: {systemStatus.backend ? 'Online' : 'Offline'}
                        </span>
                    </div>
                    <div className="card text-center">
                        <div className={`status-dot ${systemStatus.binance ? 'status-online' : 'status-offline'}`}></div>
                        <span className="text-sm font-medium">
                            Binance: {systemStatus.binance ? 'Conectada' : 'Desconectada'}
                        </span>
                        <button 
                            className="btn-primary mt-2 text-xs px-2 py-1"
                            onClick={() => checkSystemStatus()}
                        >
                            🔗 Conectar
                        </button>
                    </div>
                    <div className="card text-center">
                        <div className={`status-dot ${systemStatus.ai_agent ? 'status-online' : 'status-offline'}`}></div>
                        <span className="text-sm font-medium">
                            AI Agent: {systemStatus.ai_agent ? 'Ativo' : 'Inativo'}
                        </span>
                        <button 
                            className="btn-primary mt-2 text-xs px-2 py-1"
                            onClick={() => setNotification('Funcionalidade em desenvolvimento')}
                        >
                            🤖 Iniciar
                        </button>
                    </div>
                    <div className="card text-center">
                        <div className={`status-dot ${systemStatus.watchlist ? 'status-online' : 'status-offline'}`}></div>
                        <span className="text-sm font-medium">
                            Watchlist: {systemStatus.watchlist ? 'Ativa' : 'Inativa'}
                        </span>
                        <button 
                            className="btn-primary mt-2 text-xs px-2 py-1"
                            onClick={() => loadWatchlistData()}
                        >
                            📊 Carregar
                        </button>
                    </div>
                </div>
            );

            // Renderizar resumo da watchlist
            const renderWatchlistSummary = () => {
                if (!watchlistSummary) return null;

                return (
                    <div className="card">
                        <h3 className="text-lg font-bold mb-4 flex items-center">
                            📊 Resumo da Watchlist
                            <button 
                                className="btn-primary ml-auto text-sm px-3 py-1"
                                onClick={updateWatchlistPrices}
                            >
                                🔄 Atualizar Preços
                            </button>
                        </h3>
                        
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div className="text-center">
                                <div className="text-2xl font-bold text-blue-600">
                                    {watchlistSummary.total_coins}
                                </div>
                                <div className="text-sm text-gray-600">Total Moedas</div>
                            </div>
                            <div className="text-center">
                                <div className="text-2xl font-bold text-green-600">
                                    {watchlistSummary.trading_enabled}
                                </div>
                                <div className="text-sm text-gray-600">Para Trading</div>
                            </div>
                            <div className="text-center">
                                <div className="text-2xl font-bold text-green-500">
                                    {watchlistSummary.price_stats?.positive_performers || 0}
                                </div>
                                <div className="text-sm text-gray-600">Em Alta</div>
                            </div>
                            <div className="text-center">
                                <div className="text-2xl font-bold text-red-500">
                                    {watchlistSummary.price_stats?.negative_performers || 0}
                                </div>
                                <div className="text-sm text-gray-600">Em Baixa</div>
                            </div>
                        </div>
                        
                        <div className="mt-4 pt-4 border-t">
                            <h4 className="font-semibold mb-2">Distribuição por Tier:</h4>
                            <div className="flex flex-wrap gap-2">
                                {Object.entries(watchlistSummary.tier_distribution || {}).map(([tier, count]) => (
                                    <span key={tier} className={`tier-badge tier-${tier.replace('alt_', '')}`}>
                                        {tier}: {count}
                                    </span>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            };

            // Renderizar top performers
            const renderTopPerformers = () => (
                <div className="card">
                    <h3 className="text-lg font-bold mb-4">🏆 Top Performers (24h)</h3>
                    {topPerformers.length > 0 ? (
                        <div className="space-y-2">
                            {topPerformers.slice(0, 5).map((coin, index) => (
                                <div key={coin.symbol} className="flex items-center justify-between p-2 bg-gray-50 rounded">
                                    <div className="flex items-center">
                                        <span className="text-sm font-bold mr-2">#{index + 1}</span>
                                        <div>
                                            <div className="font-semibold">{coin.symbol}</div>
                                            <div className="text-xs text-gray-600">{coin.name}</div>
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <div className={`font-bold ${
                                            (coin.change_24h || 0) >= 0 ? 'performance-positive' : 'performance-negative'
                                        }`}>
                                            {((coin.change_24h || 0) * 100).toFixed(2)}%
                                        </div>
                                        <div className="text-xs text-gray-600">
                                            ${(coin.price || 0).toFixed(8)}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="text-center text-gray-500 py-4">
                            Nenhum dado disponível
                        </div>
                    )}
                </div>
            );

            // Renderizar alertas
            const renderAlerts = () => (
                <div className="card">
                    <h3 className="text-lg font-bold mb-4">🚨 Alertas Recentes</h3>
                    {watchlistAlerts.length > 0 ? (
                        <div className="space-y-2 max-h-64 overflow-y-auto">
                            {watchlistAlerts.map((alert, index) => (
                                <div key={index} className={`p-3 rounded alert-${alert.type?.toLowerCase() || 'volume'}`}>
                                    <div className="flex items-center justify-between">
                                        <div className="font-semibold">{alert.symbol}</div>
                                        <div className="text-xs text-gray-600">
                                            {new Date(alert.timestamp).toLocaleTimeString()}
                                        </div>
                                    </div>
                                    <div className="text-sm mt-1">{alert.message}</div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="text-center text-gray-500 py-4">
                            Nenhum alerta recente
                        </div>
                    )}
                </div>
            );

            // Renderizar painel de trading
            const renderTradingPanel = () => (
                <div className="card">
                    <h3 className="text-lg font-bold mb-4">🚀 Controles de Trading</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium mb-1">Par</label>
                            <input 
                                type="text"
                                value={settings.symbol}
                                onChange={(e) => setSettings({...settings, symbol: e.target.value})}
                                className="w-full border rounded px-3 py-2"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium mb-1">Quantidade (USD)</label>
                            <input 
                                type="number"
                                value={settings.amount}
                                onChange={(e) => setSettings({...settings, amount: parseFloat(e.target.value)})}
                                className="w-full border rounded px-3 py-2"
                                step="0.01"
                            />
                        </div>
                    </div>
                    
                    <div className="grid grid-cols-2 gap-4">
                        <button 
                            onClick={() => executeTrade('buy')}
                            className="btn-primary btn-success py-3"
                            disabled={!systemStatus.binance}
                        >
                            🚀 COMPRAR
                        </button>
                        <button 
                            onClick={() => executeTrade('sell')}
                            className="btn-primary btn-danger py-3"
                            disabled={!systemStatus.binance}
                        >
                            📉 VENDER
                        </button>
                    </div>
                    
                    {!systemStatus.binance && (
                        <div className="mt-2 text-xs text-red-600 text-center">
                            ⚠️ Binance desconectada
                        </div>
                    )}
                </div>
            );

            // Renderizar watchlist completa
            const renderWatchlistTable = () => {
                if (!watchlist) return null;

                const coins = Object.entries(watchlist);
                const filteredCoins = selectedTier === 'all' 
                    ? coins 
                    : coins.filter(([symbol, coin]) => coin.tier === selectedTier);

                return (
                    <div className="card">
                        <div className="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                            <h3 className="text-lg font-bold">💰 Watchlist Completa</h3>
                            <div className="flex items-center space-x-2 mt-2 md:mt-0">
                                <select 
                                    value={selectedTier}
                                    onChange={(e) => setSelectedTier(e.target.value)}
                                    className="border rounded px-3 py-1 text-sm"
                                >
                                    <option value="all">Todos os Tiers</option>
                                    <option value="tier1">Tier 1</option>
                                    <option value="tier2">Tier 2</option>
                                    <option value="tier3">Tier 3</option>
                                    <option value="trending">Trending</option>
                                    <option value="alt_defi">DeFi</option>
                                    <option value="alt_layer1">Layer 1</option>
                                    <option value="alt_ai_tokens">AI Tokens</option>
                                </select>
                            </div>
                        </div>

                        <div className="overflow-x-auto">
                            <table className="w-full text-sm">
                                <thead>
                                    <tr className="border-b">
                                        <th className="text-left py-2">Moeda</th>
                                        <th className="text-left py-2">Tier</th>
                                        <th className="text-right py-2">Preço</th>
                                        <th className="text-right py-2">24h %</th>
                                        <th className="text-right py-2">Volume</th>
                                        <th className="text-center py-2">Trading</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredCoins.map(([symbol, coin]) => (
                                        <tr key={symbol} className="border-b hover:bg-gray-50">
                                            <td className="py-2">
                                                <div>
                                                    <div className="font-semibold">{symbol}</div>
                                                    <div className="text-xs text-gray-600">{coin.name}</div>
                                                </div>
                                            </td>
                                            <td className="py-2">
                                                <span className={`tier-badge tier-${coin.tier?.replace('alt_', '') || 'unknown'}`}>
                                                    {coin.tier}
                                                </span>
                                            </td>
                                            <td className="text-right py-2">
                                                ${(coin.price || 0).toFixed(8)}
                                            </td>
                                            <td className={`text-right py-2 font-semibold ${
                                                (coin.change_24h || 0) >= 0 ? 'performance-positive' : 'performance-negative'
                                            }`}>
                                                {((coin.change_24h || 0) * 100).toFixed(2)}%
                                            </td>
                                            <td className="text-right py-2">
                                                ${((coin.volume_24h || 0) / 1000000).toFixed(2)}M
                                            </td>
                                            <td className="text-center py-2">
                                                {coin.trading_enabled ? (
                                                    <span className="text-green-600">✅</span>
                                                ) : (
                                                    <span className="text-gray-400">❌</span>
                                                )}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                        
                        <div className="mt-4 text-sm text-gray-600 text-center">
                            Mostrando {filteredCoins.length} de {coins.length} moedas
                        </div>
                    </div>
                );
            };

            // Renderizar histórico de trades
            const renderTradesHistory = () => (
                <div className="card">
                    <h3 className="text-lg font-bold mb-4">📊 Histórico de Trades</h3>
                    {trades.length > 0 ? (
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm">
                                <thead>
                                    <tr className="border-b">
                                        <th className="text-left py-2">Data</th>
                                        <th className="text-left py-2">Tipo</th>
                                        <th className="text-left py-2">Par</th>
                                        <th className="text-right py-2">Quantidade</th>
                                        <th className="text-right py-2">Preço</th>
                                        <th className="text-right py-2">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {trades.slice(0, 10).map((trade, index) => (
                                        <tr key={index} className="border-b hover:bg-gray-50">
                                            <td className="py-2">
                                                {new Date(trade.date).toLocaleString()}
                                            </td>
                                            <td className="py-2">
                                                <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                                    trade.type === 'buy' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                                }`}>
                                                    {trade.type?.toUpperCase()}
                                                </span>
                                            </td>
                                            <td className="py-2">{trade.symbol}</td>
                                            <td className="text-right py-2">{(trade.amount || 0).toFixed(6)}</td>
                                            <td className="text-right py-2">${(trade.price || 0).toFixed(6)}</td>
                                            <td className="text-right py-2">${(trade.total || 0).toFixed(2)}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    ) : (
                        <div className="text-center text-gray-500 py-4">
                            Nenhum trade realizado
                        </div>
                    )}
                </div>
            );

            // Renderizar conteúdo principal
            const renderMainContent = () => {
                if (loading) {
                    return (
                        <div className="flex items-center justify-center py-20">
                            <div className="text-center">
                                <div className="loading-spinner mb-4"></div>
                                <div className="text-gray-600">Carregando sistema...</div>
                            </div>
                        </div>
                    );
                }

                switch (activeTab) {
                    case 'overview':
                        return (
                            <div className="space-y-6">
                                {renderSystemStatus()}
                                {systemStatus.watchlist && renderWatchlistSummary()}
                                
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    {systemStatus.watchlist && renderTopPerformers()}
                                    {systemStatus.watchlist && renderAlerts()}
                                </div>
                                
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    {renderTradingPanel()}
                                    {renderTradesHistory()}
                                </div>
                            </div>
                        );
                    case 'watchlist':
                        return (
                            <div className="space-y-6">
                                {systemStatus.watchlist ? (
                                    <>
                                        {renderWatchlistSummary()}
                                        {renderWatchlistTable()}
                                    </>
                                ) : (
                                    <div className="text-center py-20">
                                        <div className="text-6xl mb-4">📊</div>
                                        <div className="text-xl font-semibold text-gray-600 mb-2">
                                            Watchlist Indisponível
                                        </div>
                                        <div className="text-gray-500">
                                            Verifique se o backend está rodando
                                        </div>
                                        <button 
                                            onClick={initializeSystem}
                                            className="btn-primary mt-4"
                                        >
                                            🔄 Tentar Novamente
                                        </button>
                                    </div>
                                )}
                            </div>
                        );
                    case 'trading':
                        return (
                            <div className="space-y-6">
                                {renderTradingPanel()}
                                {renderTradesHistory()}
                            </div>
                        );
                    case 'settings':
                        return (
                            <div className="card">
                                <h3 className="text-lg font-bold mb-4">⚙️ Configurações</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Auto-refresh</label>
                                        <input 
                                            type="checkbox"
                                            checked={autoRefresh}
                                            onChange={(e) => setAutoRefresh(e.target.checked)}
                                            className="mr-2"
                                        />
                                        <span className="text-sm">Atualização automática (30s)</span>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Par padrão</label>
                                        <input 
                                            type="text"
                                            value={settings.symbol}
                                            onChange={(e) => setSettings({...settings, symbol: e.target.value})}
                                            className="w-full border rounded px-3 py-2"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Quantidade padrão (USD)</label>
                                        <input 
                                            type="number"
                                            value={settings.amount}
                                            onChange={(e) => setSettings({...settings, amount: parseFloat(e.target.value)})}
                                            className="w-full border rounded px-3 py-2"
                                            step="0.01"
                                        />
                                    </div>
                                    <button 
                                        onClick={() => setNotification('Configurações salvas!')}
                                        className="btn-primary"
                                    >
                                        💾 Salvar Configurações
                                    </button>
                                </div>
                            </div>
                        );
                    default:
                        return null;
                }
            };

            // Efeito para carregar dados iniciais
            useEffect(() => {
                loadData();
                loadWatchlistData();
            }, [settings.symbol]);

            // Auto-refresh
            useEffect(() => {
                if (!autoRefresh) return;
                
                const interval = setInterval(() => {
                    loadData();
                    loadWatchlistData();
                }, refreshInterval);
                
                return () => clearInterval(interval);
            }, [autoRefresh, refreshInterval, settings.symbol]);

            // Executar negociação
            const executeTrade = async (type) => {
                try {
                    const result = await apiRequest('/execute_trade', {
                        method: 'POST',
                        body: JSON.stringify({
                            type,
                            symbol: settings.symbol,
                            amount: settings.amount
                        })
                    });
                    
                    setNotification(`${type.toUpperCase()} executado com sucesso!`);
                    setTimeout(() => setNotification(''), 3000);
                    
                    // Recarregar dados
                    loadData();
                    
                } catch (err) {
                    setError(`Erro ao executar ${type}: ${err.message}`);
                }
            };

            // Salvar configurações
            const saveSettings = async (newSettings) => {
                try {
                    await apiRequest('/settings', {
                        method: 'POST',
                        body: JSON.stringify(newSettings)
                    });
                    
                    setSettings(newSettings);
                    setNotification('Configurações salvas com sucesso!');
                    setTimeout(() => setNotification(''), 3000);
                    
                    // Recarregar dados com novo símbolo
                    loadData();
                    
                } catch (err) {
                    setError(`Erro ao salvar configurações: ${err.message}`);
                }
            };

            // Exportar CSV
            const exportToCSV = () => {
                const csv = Papa.unparse(trades);
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `mocove_trades_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                URL.revokeObjectURL(url);
            };

            // Efeitos
            useEffect(() => {
                loadData();
                
                // Atualizar a cada 60 segundos
                const interval = setInterval(loadData, 60000);
                return () => clearInterval(interval);
            }, []);

            useEffect(() => {
                updateChart();
            }, [prices]);

            // Renderização
            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500 mx-auto"></div>
                            <p className="mt-4 text-gray-600">Carregando MoCoVe...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-100">
                    {/* Header */}
                    <header className="bg-white shadow-sm border-b">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center py-4">
                                <div className="flex items-center">
                                    <h1 className="text-3xl font-bold text-gray-900">MoCoVe</h1>
                                    <span className="ml-2 text-sm text-gray-500">Trading Bot de Memecoins</span>
                                </div>
                                <div className="flex items-center space-x-4">
                                    <div className="flex items-center">
                                        <span className={`status-dot ${status.exchange_connected ? 'status-online' : 'status-offline'}`}></span>
                                        <span className="text-sm">
                                            {status.exchange_connected ? 'Binance Conectado' : 'Binance Desconectado'}
                                        </span>
                                    </div>
                                    {status.testnet_mode && (
                                        <span className="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs">
                                            TESTNET
                                        </span>
                                    )}
                                </div>
                            </div>
                        </div>
                    </header>

                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                        
                        {/* Notificações */}
                        {error && (
                            <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                                {error}
                                <button 
                                    onClick={() => setError('')}
                                    className="float-right text-red-500 hover:text-red-700"
                                >
                                    ×
                                </button>
                            </div>
                        )}
                        
                        {notification && (
                            <div className="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                                {notification}
                            </div>
                        )}

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            
                            {/* Painel Principal */}
                            <div className="lg:col-span-2 space-y-6">
                                
                                {/* Dados de Mercado */}
                                <div className="card">
                                    <h3 className="text-lg font-semibold mb-4">Dados de Mercado - {settings.symbol}</h3>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <div className="text-center">
                                            <p className="text-sm text-gray-500">Preço Atual</p>
                                            <p className="text-xl font-bold text-blue-600">
                                                ${marketData.price?.toFixed(6) || '0.000000'}
                                            </p>
                                        </div>
                                        <div className="text-center">
                                            <p className="text-sm text-gray-500">Variação 24h</p>
                                            <p className={`text-xl font-bold ${(marketData.percentage || 0) >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                {marketData.percentage?.toFixed(2) || '0.00'}%
                                            </p>
                                        </div>
                                        <div className="text-center">
                                            <p className="text-sm text-gray-500">Volatilidade</p>
                                            <p className={`text-xl font-bold ${volatility.is_high ? 'volatility-high' : 'text-gray-900'}`}>
                                                {(volatility.volatility * 100).toFixed(2)}%
                                            </p>
                                        </div>
                                        <div className="text-center">
                                            <p className="text-sm text-gray-500">Volume</p>
                                            <p className="text-xl font-bold text-gray-900">
                                                {marketData.volume?.toLocaleString() || '0'}
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {/* Gráfico */}
                                <div className="card">
                                    <h3 className="text-lg font-semibold mb-4">Gráfico de Preços</h3>
                                    <div style={{ height: '400px' }}>
                                        <canvas ref={chartRef}></canvas>
                                    </div>
                                </div>

                                {/* Histórico de Negociações */}
                                <div className="card">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-lg font-semibold">Histórico de Negociações</h3>
                                        <button 
                                            onClick={exportToCSV}
                                            className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 text-sm"
                                        >
                                            Exportar CSV
                                        </button>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full table-auto">
                                            <thead>
                                                <tr className="bg-gray-50">
                                                    <th className="px-4 py-2 text-left">Data</th>
                                                    <th className="px-4 py-2 text-left">Tipo</th>
                                                    <th className="px-4 py-2 text-left">Par</th>
                                                    <th className="px-4 py-2 text-right">Quantidade</th>
                                                    <th className="px-4 py-2 text-right">Preço</th>
                                                    <th className="px-4 py-2 text-right">Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {trades.length === 0 ? (
                                                    <tr>
                                                        <td colSpan="6" className="text-center py-4 text-gray-500">
                                                            Nenhuma negociação encontrada
                                                        </td>
                                                    </tr>
                                                ) : (
                                                    trades.map(trade => (
                                                        <tr key={trade.id} className="border-t">
                                                            <td className="px-4 py-2">
                                                                {new Date(trade.date).toLocaleString()}
                                                            </td>
                                                            <td className="px-4 py-2">
                                                                <span className={`px-2 py-1 rounded-full text-xs ${
                                                                    trade.type === 'buy' 
                                                                        ? 'bg-green-100 text-green-800' 
                                                                        : 'bg-red-100 text-red-800'
                                                                }`}>
                                                                    {trade.type.toUpperCase()}
                                                                </span>
                                                            </td>
                                                            <td className="px-4 py-2">{trade.symbol}</td>
                                                            <td className="px-4 py-2 text-right">{trade.amount}</td>
                                                            <td className="px-4 py-2 text-right">${trade.price.toFixed(6)}</td>
                                                            <td className="px-4 py-2 text-right">${trade.total.toFixed(2)}</td>
                                                        </tr>
                                                    ))
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            {/* Painel Lateral */}
                            <div className="space-y-6">
                                
                                {/* Controles de Trading */}
                                <div className="card">
                                    <h3 className="text-lg font-semibold mb-4">Controles de Trading</h3>
                                    <div className="space-y-3">
                                        <button 
                                            onClick={() => executeTrade('buy')}
                                            className="w-full bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600 font-semibold"
                                        >
                                            🚀 COMPRAR
                                        </button>
                                        <button 
                                            onClick={() => executeTrade('sell')}
                                            className="w-full bg-red-500 text-white py-2 px-4 rounded hover:bg-red-600 font-semibold"
                                        >
                                            📉 VENDER
                                        </button>
                                    </div>
                                </div>

                                {/* Configurações */}
                                <SettingsPanel 
                                    settings={settings} 
                                    onSave={saveSettings}
                                />

                                {/* Status da Volatilidade */}
                                <div className="card">
                                    <h3 className="text-lg font-semibold mb-4">Status da Volatilidade</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span>Volatilidade Atual:</span>
                                            <span className={volatility.is_high ? 'volatility-high' : ''}>
                                                {(volatility.volatility * 100).toFixed(2)}%
                                            </span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>Limite:</span>
                                            <span>{(volatility.threshold * 100).toFixed(2)}%</span>
                                        </div>
                                        {volatility.is_high && (
                                            <div className="bg-red-100 text-red-800 p-2 rounded text-sm">
                                                ⚠️ Alta volatilidade detectada!
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* Watchlist Summary */}
                                {watchlistSummary && (
                                    <div className="card">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-lg font-semibold">Resumo da Watchlist</h3>
                                            <button 
                                                onClick={updateWatchlistPrices}
                                                className="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600"
                                            >
                                                🔄 Atualizar
                                            </button>
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="text-center">
                                                <p className="text-2xl font-bold text-blue-600">{watchlistSummary.total_coins}</p>
                                                <p className="text-sm text-gray-500">Total de Moedas</p>
                                            </div>
                                            <div className="text-center">
                                                <p className="text-2xl font-bold text-green-600">{watchlistSummary.trading_enabled}</p>
                                                <p className="text-sm text-gray-500">Habilitadas</p>
                                            </div>
                                            <div className="text-center">
                                                <p className="text-2xl font-bold text-green-600">{watchlistSummary.price_stats?.positive_performers || 0}</p>
                                                <p className="text-sm text-gray-500">Em Alta</p>
                                            </div>
                                            <div className="text-center">
                                                <p className="text-2xl font-bold text-red-600">{watchlistSummary.price_stats?.negative_performers || 0}</p>
                                                <p className="text-sm text-gray-500">Em Baixa</p>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Top Performers */}
                                {topPerformers.length > 0 && (
                                    <div className="card">
                                        <h3 className="text-lg font-semibold mb-4">🔥 Top Performers (24h)</h3>
                                        <div className="space-y-2">
                                            {topPerformers.slice(0, 5).map((coin, index) => (
                                                <div key={coin.symbol} className="flex justify-between items-center p-2 bg-gray-50 rounded">
                                                    <div className="flex items-center space-x-2">
                                                        <span className="text-sm font-bold text-gray-500">#{index + 1}</span>
                                                        <span className="font-semibold">{coin.symbol}</span>
                                                        <span className="text-sm text-gray-500">{coin.name}</span>
                                                    </div>
                                                    <div className="text-right">
                                                        <p className={`font-bold ${coin.change_24h >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                            {(coin.change_24h * 100).toFixed(2)}%
                                                        </p>
                                                        <p className="text-sm text-gray-500">
                                                            ${coin.price?.toFixed(6) || '0.000000'}
                                                        </p>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* Alertas Recentes */}
                                {watchlistAlerts.length > 0 && (
                                    <div className="card">
                                        <h3 className="text-lg font-semibold mb-4">🚨 Alertas Recentes</h3>
                                        <div className="space-y-2 max-h-64 overflow-y-auto">
                                            {watchlistAlerts.map((alert, index) => (
                                                <div key={index} className={`p-3 rounded text-sm ${
                                                    alert.type === 'PUMP' ? 'bg-green-100 text-green-800' :
                                                    alert.type === 'DUMP' ? 'bg-red-100 text-red-800' :
                                                    'bg-yellow-100 text-yellow-800'
                                                }`}>
                                                    <div className="flex justify-between items-center">
                                                        <span className="font-semibold">{alert.symbol}</span>
                                                        <span className="text-xs">
                                                            {new Date(alert.timestamp).toLocaleTimeString()}
                                                        </span>
                                                    </div>
                                                    <p className="mt-1">{alert.message}</p>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Watchlist Completa */}
                            <div className="lg:col-span-3">
                                {watchlist && (
                                    <div className="card">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-xl font-semibold">📊 Watchlist Completa</h3>
                                            <div className="flex space-x-2">
                                                <select 
                                                    value={selectedTier}
                                                    onChange={(e) => setSelectedTier(e.target.value)}
                                                    className="border border-gray-300 rounded px-3 py-1 text-sm"
                                                >
                                                    <option value="all">Todos os Tiers</option>
                                                    <option value="tier1">Tier 1 (Top Memecoins)</option>
                                                    <option value="tier2">Tier 2 (Mid Memecoins)</option>
                                                    <option value="tier3">Tier 3 (Small Memecoins)</option>
                                                    <option value="trending">Trending</option>
                                                    <option value="alt_defi">DeFi</option>
                                                    <option value="alt_layer1">Layer 1</option>
                                                    <option value="alt_ai_tokens">AI Tokens</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div className="overflow-x-auto">
                                            <table className="min-w-full">
                                                <thead>
                                                    <tr className="bg-gray-50">
                                                        <th className="px-4 py-2 text-left">Símbolo</th>
                                                        <th className="px-4 py-2 text-left">Nome</th>
                                                        <th className="px-4 py-2 text-left">Tier</th>
                                                        <th className="px-4 py-2 text-right">Preço</th>
                                                        <th className="px-4 py-2 text-right">Variação 24h</th>
                                                        <th className="px-4 py-2 text-right">Volume 24h</th>
                                                        <th className="px-4 py-2 text-center">Trading</th>
                                                        <th className="px-4 py-2 text-center">Última Atualização</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {watchlist.coins && Object.entries(watchlist.coins)
                                                        .filter(([symbol, coin]) => 
                                                            selectedTier === 'all' || coin.tier === selectedTier
                                                        )
                                                        .sort((a, b) => (b[1].price_change_24h || 0) - (a[1].price_change_24h || 0))
                                                        .map(([symbol, coin]) => (
                                                            <tr key={symbol} className="border-b hover:bg-gray-50">
                                                                <td className="px-4 py-2 font-semibold">{symbol}</td>
                                                                <td className="px-4 py-2">{coin.name}</td>
                                                                <td className="px-4 py-2">
                                                                    <span className={`px-2 py-1 rounded text-xs ${
                                                                        coin.tier === 'tier1' ? 'bg-gold-100 text-gold-800' :
                                                                        coin.tier === 'tier2' ? 'bg-silver-100 text-silver-800' :
                                                                        coin.tier === 'tier3' ? 'bg-bronze-100 text-bronze-800' :
                                                                        coin.tier === 'trending' ? 'bg-purple-100 text-purple-800' :
                                                                        'bg-blue-100 text-blue-800'
                                                                    }`}>
                                                                        {coin.tier}
                                                                    </span>
                                                                </td>
                                                                <td className="px-4 py-2 text-right font-mono">
                                                                    ${coin.current_price?.toFixed(8) || '0.00000000'}
                                                                </td>
                                                                <td className={`px-4 py-2 text-right font-bold ${
                                                                    (coin.price_change_24h || 0) >= 0 ? 'text-green-600' : 'text-red-600'
                                                                }`}>
                                                                    {coin.price_change_24h ? `${(coin.price_change_24h * 100).toFixed(2)}%` : 'N/A'}
                                                                </td>
                                                                <td className="px-4 py-2 text-right">
                                                                    {coin.volume_24h ? `$${(coin.volume_24h / 1000000).toFixed(2)}M` : 'N/A'}
                                                                </td>
                                                                <td className="px-4 py-2 text-center">
                                                                    <span className={`px-2 py-1 rounded text-xs ${
                                                                        coin.trading_enabled ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'
                                                                    }`}>
                                                                        {coin.trading_enabled ? '✅ Ativo' : '⏸️ Inativo'}
                                                                    </span>
                                                                </td>
                                                                <td className="px-4 py-2 text-center text-sm text-gray-500">
                                                                    {coin.last_updated ? 
                                                                        new Date(coin.last_updated).toLocaleString() : 
                                                                        'Nunca'
                                                                    }
                                                                </td>
                                                            </tr>
                                                        ))
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Componente de Configurações
        function SettingsPanel({ settings, onSave }) {
            const [formData, setFormData] = useState(settings);

            useEffect(() => {
                setFormData(settings);
            }, [settings]);

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            return (
                <div className="card">
                    <h3 className="text-lg font-semibold mb-4">Configurações</h3>
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                Par de Trading
                            </label>
                            <select 
                                value={formData.symbol}
                                onChange={e => setFormData({...formData, symbol: e.target.value})}
                                className="w-full border border-gray-300 rounded px-3 py-2"
                            >
                                <option value="DOGE/BUSD">DOGE/BUSD</option>
                                <option value="SHIB/BUSD">SHIB/BUSD</option>
                                <option value="PEPE/BUSD">PEPE/BUSD</option>
                                <option value="FLOKI/BUSD">FLOKI/BUSD</option>
                            </select>
                        </div>
                        
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                Quantidade
                            </label>
                            <input 
                                type="number"
                                value={formData.amount}
                                onChange={e => setFormData({...formData, amount: parseFloat(e.target.value)})}
                                className="w-full border border-gray-300 rounded px-3 py-2"
                                step="0.01"
                                min="0"
                            />
                        </div>
                        
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                Limite de Volatilidade (%)
                            </label>
                            <input 
                                type="number"
                                value={formData.volatility_threshold * 100}
                                onChange={e => setFormData({...formData, volatility_threshold: e.target.value / 100})}
                                className="w-full border border-gray-300 rounded px-3 py-2"
                                step="0.1"
                                min="0"
                                max="100"
                            />
                        </div>
                        
                        <button 
                            type="submit"
                            className="w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600"
                        >
                            Salvar Configurações
                        </button>
                    </form>
                </div>
            );
        }

        // Renderizar aplicação
        ReactDOM.render(<MoCoVeApp />, document.getElementById('root'));
    </script>
</body>
</html>
